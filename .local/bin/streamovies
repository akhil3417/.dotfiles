#!/bin/bash
domain="https://www.2embed.to"
# other alternatives  https://github.com/yukithang13/MovieYuu  https://github.com/axnguyenit/ax-movies
[[ "$*" ]] && q="$*" || read -p "Enter Movie or Show Title: " q
[[ "$q" ]] || exit

results="$(wget -qO- "$domain/library/search?keyword=$q"|grep "d-block")"

function list(){
  while read l
  do
    url="${domain}$(echo $l|cut -d\" -f2)"
    title="$(echo $l|cut -d\> -f2)"
    echo -e "$title|$url"
  done < <(echo $results|tr "<" "\n"|grep "bop-name")
}

selection="$(list|fzf)"
[[ $selection ]] || exit

url="$(echo $selection|cut -d\| -f2)"
echo "$url" "$q"
echo ": $(date +%s):0;open \"$url $q\"" >> $HOME/.streamovieshistory
firefox -p KodachiBrowserLight "$url"
